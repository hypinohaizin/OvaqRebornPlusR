package net.shoreline.client.impl.module.exploit;

import net.minecraft.entity.Entity;
import net.minecraft.entity.vehicle.BoatEntity;
import net.minecraft.network.packet.c2s.play.PlayerInputC2SPacket;
import net.minecraft.network.packet.c2s.play.VehicleMoveC2SPacket;
import net.minecraft.util.math.Vec3d;
import net.shoreline.client.api.config.Config;
import net.shoreline.client.api.config.setting.NumberConfig;
import net.shoreline.client.api.module.ModuleCategory;
import net.shoreline.client.api.module.ToggleModule;
import net.shoreline.client.impl.event.TickEvent;
import net.shoreline.client.util.chat.ChatUtil;
import net.shoreline.eventbus.annotation.EventListener;

public final class BoatExploitModule extends ToggleModule {

    private final Config<Integer> height = new NumberConfig<>("Height", "Height to use for BoatKill", 111, 1, 200);

    private Vec3d origin;
    private int step;

    public BoatExploitModule() {
        super("BoatExploit", "Kills players in a boat with desync packets",ModuleCategory.EXPLOITS);
    }

    @Override
    protected void onEnable() {
        if (!(mc.player.getVehicle() instanceof BoatEntity)) {
            ChatUtil.clientSendMessage("Â§c" + "Please activate after rideing the boat.");
            disable();
            return;
        }
        origin = mc.player.getVehicle().getPos();
        step = 0;
    }

    @EventListener
    public void onTick(TickEvent event){
        Entity vehicle = mc.player.getVehicle();
        if (!(vehicle instanceof BoatEntity)) {
            disable();
            return;
        }

        if (step < 15) {
            move(vehicle, origin);
        } else if (step == 15) {
            move(vehicle, origin.add(0, height.getValue(), 0));
        } else if (step == 16) {
            move(vehicle, origin.add(0, 0.0001, 0));
            mc.player.networkHandler.sendPacket(new PlayerInputC2SPacket(0.0f, 0.0f, false, true));
            disable();
        }
        step++;
    }

    private void move(Entity vehicle, Vec3d pos) {
        vehicle.setPosition(pos);
        mc.player.networkHandler.sendPacket(new VehicleMoveC2SPacket(vehicle));
    }
}
